# Rodent population dynamics drive timing of Lassa fever outbreaks

### _Manuscript in prep_

### Gregory  C. Milne, Lauren A. Attfield, Joachim Mari√´n, Lucinda Kirkpatrick, Kate E. Jones, Christl A. Donnelly, David W. Redding

## Navigation

-   üìÅ **Data** contains _most_ of the data required for analyses; for more information see the **Data** section below
-   üìÅ **Plots** contains figures generated by analyses in the **R** folder
-   üìÅ **R** contains R scripts
-   üìÅ **Outputs** contains data outputs generated from the R scripts
-   üìÅ **stan** contains Stan scripts defining Bayesian demographic process models

## Data

Data citations:
- ü§ß [Lassa fever case data (Nigerian Centre for Disease Control Situation Reports)](https://ncdc.gov.ng/diseases/sitreps/?cat=5&name=An%20update%20of%20Lassa%20fever%20outbreak%20in%20Nigeria)
- üê≠ [Capture-mark-recapture (CMR) paper](https://www.nature.com/articles/s41597-023-02700-3) and [data](https://zenodo.org/records/10049811)
- :drop_of_blood: [Morogoro arenavirus (MORV) serological data paper](https://besjournals.onlinelibrary.wiley.com/doi/10.1111/1365-2656.13107)

Files not present in the data folder due to their large size or not being open access (flagged with ‚õî in _Workflow_, below):
- üèû NOAA daily climate rasters for [temperature](https://downloads.psl.noaa.gov/Datasets/cpc_global_temp/) & [precipitation](https://downloads.psl.noaa.gov/Datasets/cpc_global_precip/)
- :file_cabinet: Some large files that are generated from running the scripts
- :drop_of_blood: MORV serological data are not open access; potential collaborators are encouraged to contact J. Mari√´n (jmarien@itg.be)

## Workflow

### Integral projection model (IPM)
- `R/rodent_model.R` contains defines functions to simulate rodent popultion dynamics & transmission dynamics using an IPM.
- Transmission is modelled using a nested comparmental model: susceptible, horizontally infected, vertically infected, recovered (SHVR).
- Subsequent scripts that source the model tend to use `R/setup_IPM.R` which establishes the necessary environment (data, model parameters) for simulation.
- The IPM is simulated using demographic process models (body weight change, survival, and recruitment) that are fit in `R/01_model_fit_bayesian.R`.

### Data processing
- Four scripts are defined for processing different datasets.
- `R/00_demo_formatting_Morogoro.R` processes the raw CMR data into formatted data to infer the rodent demographic processes of body weight change (growth), survival, and recruitment. These data are used in demographic process model fitting (see `R/01_model_fit_bayesian.R`).
- `R/00_env_formatting.R` processes daily temperature and precipitation data ‚õî for the CMR site and 5 Nigerian states of interest, interpolating anomalous or missing values, calculating 28-day rolling averages and decomposing into trend, seasonal, and residual components using STL. These data are used in demographic process model fitting (see `R/01_model_fit_bayesian.R`).
- `R/00_format_lassa_case_data.R` processes weekly confirmed Lassa fever case reports to output a single data file (used later in `R/09c_plot_Nigeria.R`).
- `R/00_rodent_serodata_formatting.R` processes individual-level Morogoro arenavirus serological data ‚õî to calculate grouped seroprevalence by trapping session for use in subsequent transmission parameter inference (see `R/06a_fit_coarse_grid.R`, `R/06b_define_fine_grid.R`, `R/06c_fit_fine_grid.R`, and `R/07_posterior_predict.R`).

### Fitting & validating demographic process models
- `R/01_model_fit_bayesian.R` takes the processed rodent demographic data and decomposed climate data and fits Bayesian models of growth, survival, and recruitment (see folder `stan`); and a fourth model that predicts male population size from female population size.
- ‚õî _NB_: large files produced in `R/01_model_fit_bayesian.R` are not stored in this repository (i.e., `surv_stan_bestfit.rds`, `rec_stan_bestfit.rds`, and `grow_stan_bestfit.rds` (all in the `Outputs/stan_fits/` directory))
- `R/PPCs.R` performs posterior predictive checks (PPCs) on best-fitting models & makes visualisations (using the custom "ggplot" theme defined in `R/ggplot_theme.R`).

### Transforming posteriors to original scale
- `R/04_unscale_posteriors.R` transforms demographic process model parameter posterior distributions to be on the original scale of covariates (not unit scale).
- These "unscaled" posteriors are subsequently used for IPM simulation.

### Calibrating rodent survival
- `R/05a_calibrate_survival.R` estimates a constant "recapture modifier" that maintains stable simulated population dynamics.
- This is estimated separately for each location of interest and for _N_ posterior samples of the demographic process model posteriors.

### Estimating rodent transmission parameters
- `R/06a_fit_coarse_grid.R`, `R/06b_define_fine_grid.R`, and `R/06c_fit_fine_grid.R` define a Bayesian grid search algorithm for estimating approximate posterior distributions of transmission parameters using MORV seroprevalence data (obtained in `R/00_rodent_serodata_formatting.R`) ‚õî. These scripts utilise functions defined in `R/fit_funcs.R`.

### Posterior predictions in Morogoro
- `R/07_posterior_predict.R` uses the fitted demographic process models and transmission parameters and Bayesian melding to make predictive simulations of rodent dynamics at the CMR field site.
- This script also makes various plots and predicts hold-out MORV seroprevalence data ‚õî with the fitted model.
- `R/08_demo_effects_plots` uses the posterior predictions generated in the previous script to estimate and plot the contributions of each demographic and climate covariate to each modelled demographic process.

### Posterior predictions in Nigeria (Lassa fever case study)
- `R/09a_simulate_Nigeria.R` performs posterior predictions of rodent infection dynamics for each of the Nigerian states of interest and for _N_ posterior samples of the demographic process model posteriors.
- `R/09b_process_sims_Nigeria.R` processes all the simulations from the previous script, combining - for each state - _N_ .rds files into a single .rds file.
- `R/09c_plot_Nigeria.R` transforms Lassa fever cases (from `R/00_format_lassa_case_data.R`) to an infection time series, using an inferred incubation period distribution. It then uses the processed simulations to make plots of infection dynamics against the transformed empirical data.
